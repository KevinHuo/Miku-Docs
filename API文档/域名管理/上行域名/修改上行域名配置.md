# 修改上行域名配置

## 接口描述
修改指定直播空间中某个上行域名的配置

## 接口信息
- **请求方法**: PATCH
- **请求路径**: /
- **请求参数**:
  - **pushDomainConfig** (string) - 域名配置，必需
  - **name** (string) - 域名，必需  
    示例值: `www.example.com`
  - **fields** (string) - 可以指定更新具体的多个字段,目前支持：`iplimit`
    示例值: `iplimit`

## 请求参数
### Header 参数
|   参数名	|   位置	 |   类型	   |必填	 |示例值	|描述|
|:--------- |:--------|:-----------|:-----|:---------|:---|
|   Host     |	Header|	string   |	是   | `<bucket>`.mls.cn-east-1.qiniumiku.com|	请求的服务域名|
|   Authorization | Header | string | 是 | `<QiniuToken>` |  管理凭证 QiniuToken |

### Body 参数 (application/json)
示例：
```json
{
    "type":"pushRtmp",
    "auth":{
        "key":"QXV0aG9yaXphdGlvbg"
    },
    "certificateID":"my-cert"
}
```
### 参数
| 参数名称 | 类型 | 说明 | 是否必需 |
|:-----------|:--------|:--------|:------------|
| enable | boolean | 域名是否启用 | 可选 |
| type | string | 域名类型 | 可选 |
| auth | object | 防盗链配置参数信息 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 功能开关 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ type | string | 类型 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ primaryKey | string | 主 Key | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ secondaryKey | string | 从 Key | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ expireSeconds | integer | 防盗链过期时间（秒） | 可选 |
| thirdAuth | object | 访问 URL 进行回源鉴权（网易模式：GET 请求，target 为完整推流地址，需转义；HTTP 200 为通过，其他失败；超时默认通过；重试 3 次；超时 3 秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 功能开关 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ authUrl | string | 鉴权 URL | 必需 |
| streamConf | object | 流配置（StreamConf） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ gopCacheMode | integer | GOP 缓存模式（0: 秒开, 1: 低延迟, 2: LAS） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ gopCacheNum | integer | 缓存 GOP 数量 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ noDataTimeout | integer | 无数据超时断开推流（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enableTimestampModify | boolean | 是否开启时间戳修改 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsSegmentDuration | integer | HLS 切片大小（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsSegmentExpired | integer | HLS 切片缓存时间（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enableDelayPlay | boolean | 是否允许延时播放 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ expectedDelayTimeSecond | integer | 默认延时播放时长（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ lastModified | string | 最后修改时间 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ disableHttpChunk | boolean | 是否关闭 FLV Chunk 模式 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsType | integer | HLS 服务模式（0&1: 未使用，2: 中心切片，3: 边缘切片） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ disablePublisherBattle | boolean | 是否开启抢流（默认 false 表示启用抢流） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ enableBackupPublish | boolean | 是否开启主备流（默认 false 不开） | 必需 |
| certificateID | string | 证书 ID | 可选 |
| urlRewrites | []object | URL 改写规则（正则表达式）示例：http://example.com/live/abc.flv?key=aaa， 想要改写挂载点为 qiniu，匹配规则: `(.+)/live/(.+)$`，改写规则: `${1}/qiniu/${2}`， 结果: http://example.com/qiniu/abc.flv?key=aaa | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ pattern | string | 匹配规则（正则表达式，变量放括号内） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ replace | string | 改写规则（如 `${1}/qiniu/${2}`） | 必需 |
| forward | object | 推流转推域名配置 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 转推开关 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ items | []object | 转推目标列表 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─ domain | []object | 转推目的 domain | 必需 |
| ipLimit | object | IP 黑白名单配置（IpLimit） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ whitelist | []string | 白名单 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ blacklist | []string | 黑名单 | 可选 |
| httpsEnable | boolean | 是否启用 HTTPS | 可选 |

## 访问域名
```go
<bucket>.mls.cn-east-1.qiniumiku.com
```

## 认证授权
```go
Authorization: <QiniuToken>
```
- **QiniuToken 详细描述请查阅**: [这里](/docs/public/请求鉴权)

## 请求示例
```http
PATCH /?pushDomainConfig&name=www.example.com&fields=iplimit HTTP/1.1
Host: <bucket>.mls.cn-east-1.qiniumiku.com
Authorization: <QiniuToken>
Content-Type: application/json

{
    "type":"pushRtmp",
    "auth":{
        "key":"QXV0aG9yaXphdGlvbg"
    },
    "certificateID":"my-cert"
}
```

## 返回响应

### 响应状态码
- **请查阅**: [这里](/docs/public/错误返回)

### 响应示例
```json
{
    "enable": true,
    "bucketId": "my-bucket",
    "region": "ap-1",
    "domain": "www.example.com",
    "cname": "www.example.com.publish.mikudns.com",
    "type": "pushRtmp",
    "thirdAuth": {
        "enable": false,
        "authUrl": "www.example.com"
    },
    "auth": {
        "enable": true,
        "primaryKey": "QXV0aG9yaXphdGlvbg",
        "secondaryKey": "QXV0aG9yaXphdGlvbg",
        "expireSeconds": 120
    },
    "streamConf": {
        "lastModified": "2019-01-01T00:00:00Z",
        "gopCacheMode": 10,
        "gopCacheNum": 10,
        "enableTimestampModify": true,
        "disableHttpChunk": true,
        "noDataTimeout": 60,
        "hlsType": 10,
        "hlsSegmentDuration": 10,
        "hlsSegmentExpired": 10,
        "enableDelayPlay": true,
        "expectedDelayTimeSecond": 10,
        "disablePublisherBattle": true,
        "enableBackupPublish": false
    },
    "origin": {
        "enable": true,
        "type": "pushRtmp",
        "url": "http://example.com",
        "urlBackup": "",
        "timeout": 30,
        "retryTimes": 10,
        "fillowISP": true
    },
    "urlRewrites": [
        {
            "pattern": "",
            "replace": ""
        }
    ],
    "forward": {
        "enable": true,
        "item": [
            {
                "domain": "http://example.com",
                "url": "url"
            }
        ]
    },
    "refererSecurity": {
        "type": "pushRtmp",
        "list": [
            "",
            ""
        ],
        "includeEmpty": true
    },
    "certificateID": "my-cert",
    "creationDate": "2019-01-01T00:00:00Z",
    "lastModified": "2019-01-01T00:00:00Z",
    "httpsEnable": true
}
```
### 响应参数
| 参数名称 | 类型 | 说明 | 是否必需 |
|:-----------|:--------|:--------|:------------|
| bucketId | string | 空间 ID | 必需 |
| region | string | 区域 | 必需 |
| domain | string | 域名 | 必需 |
| cname | string | CNAME | 必需 |
| type | string | 域名类型 | 必需 |
| auth | object | 防盗链配置参数信息 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 功能开关 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ type | string | 类型 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ primaryKey | string | 主 Key | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ secondaryKey | string | 从 Key | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ expireSeconds | integer | 防盗链过期时间（秒） | 必需 |
| thirdAuth | object | 回源鉴权配置（访问 URL 进行回源鉴权） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 功能开关 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ authUrl | string | 鉴权 URL | 必需 |
| streamConf | object | 流配置（StreamConf） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ gopCacheMode | integer | GOP 缓存模式（0: 秒开, 1: 低延迟, 2: LAS） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ gopCacheNum | integer | 缓存 GOP 数目 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ noDataTimeout | integer | 无数据超时断开推流（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enableTimestampModify | boolean | 是否开启时间戳修改 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsSegmentDuration | integer | HLS 切片大小（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsSegmentExpired | integer | HLS 切片缓存时间（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enableDelayPlay | boolean | 是否允许延时播放 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ expectedDelayTimeSecond | integer | 默认延时播放时长（秒） | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ lastModified | string | 最后修改时间 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ disableHttpChunk | boolean | 是否关闭 FLV Chunk 模式 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ hlsType | integer | HLS 服务模式（0&1: 未使用，2: 中心切片，3: 边缘切片） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ disablePublisherBattle | boolean | 是否开启抢流（默认 false，代表启用抢流） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ enableBackupPublish | boolean | 是否开启主备流（默认 false，不开） | 必需 |
| certificateID | string | 证书 ID | 必需 |
| creationDate | string | 创建时间（ISO 8601） | 必需 |
| lastModified | string | 修改时间（ISO 8601） | 必需 |
| origin | object | 回源配置 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ enable | string | 是否开启回源 | 必需 |
| urlRewrites | []object | URL 改写规则 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ pattern | string | 匹配规则（正则表达式） | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ replace | string | 改写规则 | 必需 |
| forward | object | 转推配置 | 可选 |
| &nbsp;&nbsp;&nbsp;&nbsp;├─ enable | boolean | 是否开启转推 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;└─ items | []object | 转推目标列表 | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;├─ url | string | 转推地址，转发到此url | 必需 |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└─ domain | string | 转发到此域名 | 必需 |
| httpsEnable | boolean | 是否启用 HTTPS | 必需 |
| redirect | integer | 302 比例（≤0: 关闭；>0 时表示启用对应百分比的 302 跳转，例如 50 表示 50%） | 可选 |
